"use strict";var selectedLocation=null,selectedCuisine=null,voted=[],locationID={London:61,Birmingham:69,Liverpool:323,Manchester:68},cuisineID={italian:55,american:1,british:133,indian:148};$(".location").on("click",function(e){selectedLocation=e.target.innerHTML,$(".location").removeClass("selected"),$(".location").attr("aria-checked","false"),$(e.target).parent().parent().addClass("selected"),$(e.target).parent().parent().attr("aria-checked","true"),selectedCuisine&&fetchRestaurants(selectedLocation,selectedCuisine)}),$(".cuisine").on("click",function(e){selectedCuisine=e.target.innerHTML.toLowerCase().trim(),selectedCuisine=cuisineID[selectedCuisine],$(".cuisine").removeClass("selected-cuisine"),$(".cuisine").attr("aria-checked","false"),$(e.target).parent().addClass("selected-cuisine"),$(e.target).parent().attr("aria-checked","true"),selectedLocation&&fetchRestaurants(selectedLocation,selectedCuisine)}),$(".location").keypress(function(e){13==e.which&&(selectedLocation=$(this).attr("class").split(" ")[1],$(".location").removeClass("selected"),$(".location").attr("aria-checked","false"),$(this).addClass("selected"),$(e.target).parent().parent().attr("aria-checked","true"),selectedCuisine&&fetchRestaurants(selectedLocation,selectedCuisine))}),$(".cuisine").keypress(function(e){13==e.which&&(selectedCuisine=$(this).attr("class").split(" ")[1].toLowerCase().trim(),selectedCuisine=cuisineID[selectedCuisine],$(".cuisine").removeClass("selected-cuisine"),$(".cuisine").attr("aria-checked","false"),$(this).addClass("selected-cuisine"),$(e.target).parent().attr("aria-checked","true"),selectedLocation&&fetchRestaurants(selectedLocation,selectedCuisine))});var fetchRestaurants=function(e,t){console.log(e,t),document.getElementById("results").innerHTML='<img src="/dist/img/ring.svg" alt="fetching results"/>';var a="/api/"+e+"?cuisine="+t;fetch(a).then(function(e){return e.json()}).then(function(e){var e=JSON.parse(e.body),t=e.restaurants;document.getElementById("results").innerHTML="",t.map(function(e){document.getElementById("results").innerHTML+='<div class="restaurant"><div class="restaurant-image" id="'+e.restaurant.featured_image+'"></div>\n    <div class="restaurant-name">'+e.restaurant.name+'</div>\n    <div class="rating" style="background: #'+e.restaurant.user_rating.rating_color+'">'+e.restaurant.user_rating.aggregate_rating+'</div>\n      <div class="votes">'+e.restaurant.user_rating.votes+' votes</div>\n      <div class="new-review" name="'+e.restaurant.name+'">Add Review</div>',document.getElementById(e.restaurant.featured_image).style.backgroundImage="url('"+e.restaurant.featured_image+"')",console.log(e.restaurant)}),$(".new-review").on("click",function(e){var t=e.target.getAttribute("name");console.log(t),$('div[name="'+e.target.getAttribute("name")+'"]').parent().append('<div class="ratings-wrapper">\n      <div class="rating-value" onclick="updateRating(0, \''+t+'\')" tabindex="0">0</div>\n      <div class="rating-value" onclick="updateRating(1, \''+t+'\')" tabindex="0">1</div>\n      <div class="rating-value" onclick="updateRating(2, \''+t+'\')" tabindex="0">2</div>\n      <div class="rating-value" onclick="updateRating(3, \''+t+'\')" tabindex="0">3</div>\n      <div class="rating-value" onclick="updateRating(4, \''+t+'\')" tabindex="0">4</div>\n      <div class="rating-value" onclick="updateRating(5, \''+t+'\')" tabindex="0">5</div>\n      <br>\n      <p class="already-voted"></p>\n      <textarea class="comment" name="comment" cols="40" rows="5"></textarea>\n      </div>')})})["catch"](function(e){$(".new-review").on("click",function(e){var t=e.target.getAttribute("name");console.log(t),$('div[name="'+e.target.getAttribute("name")+'"]').parent().append('<div class="ratings-wrapper">\n      <div class="rating-value" onclick="updateRating(0, \''+t+'\')" tabindex="0">0</div>\n      <div class="rating-value" onclick="updateRating(1, \''+t+'\')" tabindex="0">1</div>\n      <div class="rating-value" onclick="updateRating(2, \''+t+'\')" tabindex="0">2</div>\n      <div class="rating-value" onclick="updateRating(3, \''+t+'\')" tabindex="0">3</div>\n      <div class="rating-value" onclick="updateRating(4, \''+t+'\')" tabindex="0">4</div>\n      <div class="rating-value" onclick="updateRating(5, \''+t+'\')" tabindex="0">5</div>\n      <br>\n      <p class="already-voted"></p>\n      <textarea class="comment" name="comment" cols="40" rows="5"></textarea>\n      </div>')})})},updateRating=function(e,t){if(voted.indexOf(t)>-1);else{var a=$("div[name='"+t+"']").parent().find(".rating")[0].innerHTML,n=$("div[name='"+t+"']").parent().find(".votes")[0].innerHTML;a=parseFloat(a),n=parseInt(n);var i=(a*n+e)/++n;$("div[name='"+t+"']").parent().find(".rating")[0].innerHTML=i.toFixed(1),$("div[name='"+t+"']").parent().find(".votes")[0].innerHTML=n,$("div[name='"+t+"']").parent().find(".already-voted")[0].innerHTML="You have submitted a review for this restaurant",voted.push(t)}};