"use strict";function minRatingUpdate(e){minimum=e,document.querySelector("#min-rating").value=e;var t=$(".restaurant"),a=t.filter(function(a){return parseFloat(t[a].querySelector(".rating").innerHTML)>=e&&parseInt(t[a].querySelector(".price").innerHTML)<=maximum});t.hide(),a.show()}function maxAverageSpendUpdate(e){maximum=e,document.querySelector("#max-average-spend").value=e;var t=$(".restaurant"),a=t.filter(function(a){return parseInt(t[a].querySelector(".price").innerHTML)<=e&&parseFloat(t[a].querySelector(".rating").innerHTML)>=minimum});t.hide(),a.show()}var selectedLocation=null,selectedCuisine=null,voted=[],restaurants=null,filtered=null,filteredRating=null,filteredPrice=null,minimum=0,maximum=130,locationID={London:61,Birmingham:69,Liverpool:323,Manchester:68},cuisineID={italian:55,american:1,british:133,indian:148};$(".location").on("click",function(e){selectedLocation=e.target.innerHTML,$(".location").removeClass("selected"),$(".location").attr("aria-checked","false"),$(e.target).parent().parent().addClass("selected"),$(e.target).parent().parent().attr("aria-checked","true"),selectedCuisine&&fetchRestaurants(selectedLocation,selectedCuisine)}),$(".cuisine").on("click",function(e){selectedCuisine=e.target.innerHTML.toLowerCase().trim(),selectedCuisine=cuisineID[selectedCuisine],$(".cuisine").removeClass("selected-cuisine"),$(".cuisine").attr("aria-checked","false"),$(e.target).parent().addClass("selected-cuisine"),$(e.target).parent().attr("aria-checked","true"),selectedLocation&&fetchRestaurants(selectedLocation,selectedCuisine)}),$(".location").keypress(function(e){13==e.which&&(selectedLocation=$(this).attr("class").split(" ")[1],$(".location").removeClass("selected"),$(".location").attr("aria-checked","false"),$(this).addClass("selected"),$(e.target).parent().parent().attr("aria-checked","true"),selectedCuisine&&fetchRestaurants(selectedLocation,selectedCuisine))}),$(".cuisine").keypress(function(e){13==e.which&&(selectedCuisine=$(this).attr("class").split(" ")[1].toLowerCase().trim(),selectedCuisine=cuisineID[selectedCuisine],$(".cuisine").removeClass("selected-cuisine"),$(".cuisine").attr("aria-checked","false"),$(this).addClass("selected-cuisine"),$(e.target).parent().attr("aria-checked","true"),selectedLocation&&fetchRestaurants(selectedLocation,selectedCuisine))});var fetchRestaurants=function(e,t){console.log(e,t),document.getElementById("filter").innerHTML='<label for="fader1">Minimum rating</label><br>\n<input type="range" min="0" max="5" value="0" id="fader1"\n	step="0.1" oninput="minRatingUpdate(value)"><br>\n  <output for="fader1" id="min-rating">0</output><br><br><br><br>',document.getElementById("filter").innerHTML+='<label for="fader2">Maximum average spend for two</label><br>\n<input type="range" min="10" max="130" value="130" id="fader2"\n	step="5" oninput="maxAverageSpendUpdate(value)"><br>\n  <span>£</span><output for="fader2" id="max-average-spend">130</output>',document.getElementById("results").innerHTML='<img src="/dist/img/ring.svg" alt="fetching results"/>';var a="/api/"+e+"?cuisine="+t;fetch(a).then(function(e){return e.json()}).then(function(e){var e=JSON.parse(e.body),t=e.restaurants;console.log(e),document.getElementById("results").innerHTML="",t.map(function(e){e.restaurant.formattedname=e.restaurant.name.replace("'",""),document.getElementById("results").innerHTML+='<div class="restaurant"><div class="restaurant-image" id="'+e.restaurant.featured_image+'"></div>\n    <div class="restaurant-name">'+e.restaurant.name+'</div>\n    <div class="rating" style="background: #'+e.restaurant.user_rating.rating_color+'">'+e.restaurant.user_rating.aggregate_rating+'</div>\n      <div class="votes">'+e.restaurant.user_rating.votes+' votes</div>\n      <div class="opening-times">12:00 - 23:00</div>\n      <span>Average price for two: £</span>\n      <div class="price">'+e.restaurant.average_cost_for_two+'</div>\n      <div class="new-review" style="display: none" name="'+e.restaurant.formattedname+'"></div>\n      <div class="ratings-wrapper">\n        <div class=\'rating-value\' onclick=\'updateRating(0, "'+e.restaurant.formattedname+"\")' tabindex='0'>0</div>\n        <div class='rating-value' onclick=\"updateRating(1, \""+e.restaurant.formattedname+"\")' tabindex='0'>1</div>\n        <div class='rating-value' onclick='updateRating(2, \""+e.restaurant.formattedname+"\")' tabindex='0'>2</div>\n        <div class='rating-value' onclick='updateRating(3, \""+e.restaurant.formattedname+"\")' tabindex='0'>3</div>\n        <div class='rating-value' onclick='updateRating(4, \""+e.restaurant.formattedname+"\")' tabindex='0'>4</div>\n        <div class='rating-value' onclick='updateRating(5, \""+e.restaurant.formattedname+'")\' tabindex=\'0\'>5</div>\n        <br>\n        <p class="already-voted"></p>\n        <textarea class="comment" name="comment" cols="40" rows="5"></textarea>\n      </div>\n      <div class="reviews"></div>',document.getElementById(e.restaurant.featured_image).style.backgroundImage="url('"+e.restaurant.featured_image+"')"}),fetchReviews()})["catch"](function(e){fetchReviews()})},updateRating=function(e,t){if(voted.indexOf(t)>-1);else{var a=$("div[name='"+t+"']").parent().find(".rating")[0].innerHTML,n=$("div[name='"+t+"']").parent().find(".votes")[0].innerHTML;a=parseFloat(a),n=parseInt(n);var i=(a*n+e)/++n;$("div[name='"+t+"']").parent().find(".rating")[0].innerHTML=i.toFixed(1),$("div[name='"+t+"']").parent().find(".votes")[0].innerHTML=n,$("div[name='"+t+"']").parent().find(".already-voted")[0].innerHTML="You have submitted a review for this restaurant",voted.push(t)}},fetchReviews=function(){var e;$.getJSON("reviews.json",function(t){e=t;for(var a=document.querySelectorAll(".restaurant"),n=0;n<a.length;n++)for(var i=Math.round(3*Math.random()),r=0;i>r;r++){var s=e[Math.floor(Math.random()*e.length)];a[n].getElementsByClassName("reviews")[0].innerHTML+='<div class="review-wrapper"><div><span>'+s.name+", </span><span>"+s.date+", </span><span>"+s.rating+"</span></div>"+s.review+"</div>"}})};